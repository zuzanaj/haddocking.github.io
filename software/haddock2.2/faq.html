---
layout: page
tags: [Jekyll, HADDOCK, Bonvin, Docking, Simulation, Molecular Dynamics, Structural Biology, Computational Biology, Modelling, Protein Structure]
modified: 2014-08-08T20:53:07.573882-04:00
comments: false
image:
  feature: pages/banner_software.jpg
---

<H1><FONT COLOR=RED>HADDOCK2.2</FONT COLOR=RED> manual</H1>

<H2 align=right> <FONT COLOR=RED>F</FONT >AQ</H2>

<HR>
We will collect here frequently occorring problems and solutions. The following topics are currently available:
<ul>
   <li> <a href="#missing">What about missing atoms or point mutations?</a>
   <li> <a href="#ions">What about ions?</a>
   <li> <a href="#domain">Domain definition for docking</a>
   <li> <a href="#cluster">Clustering issues</a>
   <li> <a href="#segments">Increasing the number of flexible segments</a>
   <li> <a href="#batch">Running in batch mode without a queuing system</a>
   <li> <a href="#batchqueue">Running in batch mode using a queuing system</a>
   <li> <a href="#ligand">Small ligands docking with HADDOCK</a>
</ul>
<hr>
<BR>
<a name="missing"><b><u>What about missing atoms or point mutations?</u></b></a>
<BR><BR>
Missing atoms will be automatically generated by HADDOCK when 
<a href="/software/haddock2.2/docking#topology">generating the topologies and PDB files</a>
of the molecules in the <b>begin</b> directory. This is done when running the <b><i>generate_X.inp</i></b>
CNS scripts (these are originally based on the <b><i>generate_easy.inp</i></b> script from
the <a href="http://cns.csb.yale.edu">CNS distribution</a>). HADDOCK uses the PDB files defined in the
<a href="/software/haddock2.2/start_new_help">new.html</a> file. In case of missing residues, chain breaks will be introduced.
<BR><BR>
When setting up the docking from an ensemble of structures it can happen that single point mutants coordinates files
are available. These can be used as well provided you do the following:
<ul>
  <li> edit the PDB file and rename the mutated residue to the proper amino acid name
	<li> keep or rename appropriately the matching side-chain atoms
</ul>
The missing atoms will be generated automatically. It is important to have at least the backbone atoms defined
since their average position will be used as starting point to "grow" the missing atoms.
Always check that the sequence of the various PDB files match!
<BR>
<hr>
<BR>
<a name="ions"><b><u> What about ions?</u></b></a>
<BR><BR>
Some proteins contains ions such as for example calcium. Their inclusion might be important for docking
purposes, in particular for proper electrostatics! In principle, they should be recognized in the 
<a href="/software/haddock2.2/docking#topology">topology generation step</a> provided their name in the PDB file
matches the ion names defined in the <b>ion.top</b> file in the <b>toppar</b> directory. To avoid that a 
N- or C-terminal patch be applied to them, they should also be defined in the <b>topallhdg5.3.pep</b>
file (look for the "first IONS" and "last IONS" statements).
<BR><BR>
Another problem can occur with ions in torsion angle dynamics since they are unconnected single atoms. In the new
HADDOCK 2.X version, for the torsion angle dynamics part of the <a href="/software/haddock2.2/docking">docking protocol</a> (it1), 
a covalent bond will be automatically defined to the closest ligand atom (only for cations). This is done in the 
<i>covalions.cns</i> CNS script in the <i><b>protocols</b></i> directory; the following cations are currently defined:
MG<sup>+2</sup>, CA<sup>+2</sup>, FE<sup>+2</sup>, FE<sup>+3</sup>, NI<sup>+2</sup>, CO<sup>+2</sup>, CO<sup>+3</sup>, 
CU<sup>+1</sup>, CU<sup>+2</sup> and ZN<sup>+2</sup>. If your system contains other ions add them to the 
<i>covalions.cns</i> file (they should however be defined in <i>ion.top</i>).
<BR>
<hr>
<BR>
<a name="domain"><b><u> Domain definition for docking</u></b></a>
<BR><BR>
In general, it is recommended to remove any part of your system such as flexible linkers 
that are not involved in the interaction with the partner for docking. Keeping these might
give trouble in the sorting of solutions. For example, such a linker can make contacts with the
partner molecule, resulting in a lower total energy and, in that way, "bad" solutions could still be kept.
<BR>
<hr>
<BR>
<a name="cluster"><b><u> Clustering issues</u></b></a>
<BR><BR>
When choosing which of the two molecules will be in the first segid (e.g. "A"), it is recommended to
choose the largest and/or most rigid one of the two. This should give better clustering results since
in the rmsd calculation for clustering (<a href="/software/haddock2.2/analysis#rmsd"><i>rmsd.inp</i></a> CNS script) the
structures are first fitted on the semi-flexible segments of the first molecule and then the rmsds are
calculated on the semi-flexible segments of the remaining molecules (defined as "ligand interface RMSD").
<BR><BR>
Defining the largest and best defined (most rigid) molecule first should thus result in a better fitting.
<BR>
<b>Note</b> that this is not an issue if fractions of common contact (<a href="/software/haddock2.2/analysis#fcc">FCC</a>) clustering is used.
<hr>
<BR>
<a name="segments"><b><u>Increasing the number of flexible segments</u></b></a>
<BR><BR>
In the current distribution, the number of flexible segment is set to 10 for the semi-flexible interface
and 5 for the fully flexible segments. If needed, these numbers can be increased. The only file that
you will need to modify is <i><b>run.cns</b></i>.
<BR><BR>
As an example, say you wish to increase the number of fully flexible segments for molecule A to 10. 
Locate in <i><b>run.cns</b></i> the section concerning the <a href="/software/haddock2.2/run#flex">fully flexible segments</a>, e.g.:
<BR>
<PRE>
{=========== Definition of fully flexible segments ==========}
{* Define the fully flexible segment of each molecule.*}
{* These segments will be allowed to move at all stages of it1 *}

{* Number of fully flexible segments for molecule (protein) A            *}
{* Note that current max is 5 (edit the run.cns to add more segments     *}

{===>} nfle_A=0; 

{* Fully flexible segments of molecule (protein) A *}
{+ table: rows=5 "segment 1" "segment 2" "segment 3" "segment 4" "segment 5" cols=2 "Start residue" "End residue" +}

{===>} A_start_fle_1=""; 
{===>} A_end_fle_1=""; 
{===>} A_start_fle_2=""; 
{===>} A_end_fle_2=""; 
{===>} A_start_fle_3=""; 
{===>} A_end_fle_3=""; 
{===>} A_start_fle_4=""; 
{===>} A_end_fle_4=""; 
{===>} A_start_fle_5=""; 
{===>} A_end_fle_5=""; 
</PRE>
<BR>
Increase the number of rows in the table definition to 10, add the additional row headers and add the additional segment definitions. The result should look
like:
<BR>
<PRE>
{=========== Definition of fully flexible segments ==========}
{* Define the fully flexible segment of each molecule.*}
{* These segments will be allowed to move at all stages of it1 *}

{* Number of fully flexible segments for molecule (protein) A            *}
{* Note that current max is 5 (edit the run.cns to add more segments     *}

{===>} nfle_A=0; 

{* Fully flexible segments of molecule (protein) A *}
{+ table: rows=5 "segment 1" "segment 2" "segment 3" "segment 4" "segment 5" cols=2 "Start residue" "End residue" +}

{===>} A_start_fle_1=""; 
{===>} A_end_fle_1=""; 
{===>} A_start_fle_2=""; 
{===>} A_end_fle_2=""; 
{===>} A_start_fle_3=""; 
{===>} A_end_fle_3=""; 
{===>} A_start_fle_4=""; 
{===>} A_end_fle_4=""; 
{===>} A_start_fle_5=""; 
{===>} A_end_fle_5=""; 
{===>} A_start_fle_6=""; 
{===>} A_end_fle_6=""; 
{===>} A_start_fle_7=""; 
{===>} A_end_fle_7=""; 
{===>} A_start_fle_8=""; 
{===>} A_end_fle_8=""; 
{===>} A_start_fle_9=""; 
{===>} A_end_fle_9=""; 
{===>} A_start_fle_10=""; 
{===>} A_end_fle_10=""; 
</PRE>
<BR>
You will also need to add additional lines further down in <i><b>run.cns</b></i> at the location where
the segment definitions are stored in the <i>toppar</i> variable, i.e.:
<BR>
<PRE>
evaluate (&toppar.A_start_fle_1=&A_start_fle_1)
evaluate (&toppar.A_start_fle_2=&A_start_fle_2)
evaluate (&toppar.A_start_fle_3=&A_start_fle_3)
evaluate (&toppar.A_start_fle_4=&A_start_fle_4)
evaluate (&toppar.A_start_fle_5=&A_start_fle_5)
evaluate (&toppar.A_start_fle_6=&A_start_fle_6)
evaluate (&toppar.A_start_fle_7=&A_start_fle_7)
evaluate (&toppar.A_start_fle_8=&A_start_fle_8)
evaluate (&toppar.A_start_fle_9=&A_start_fle_9)
evaluate (&toppar.A_start_fle_10=&A_start_fle_10)
</PRE>
<BR>
Repeat this for protein B is needed or to increase the number of flexible segments for the interface
definition.
<BR>
<hr>
<BR>
<a name="batch"><b><u> Running in batch mode without a queuing system</u></b></a>
<BR><BR>
<i> A contribution from Melissa Stauffer, Vanderbilt University, USA</i>
<BR><BR>
Here is a description of the setup on a Linux cluster that has no queuing system
installed. It has a head node/firewall with 16 dual-cpu compute nodes
behind it. From the head node, processes can be spawned to the compute
nodes using rsh. Authentication to compute nodes is done via the
/etc/hosts.equiv mechanism - no prompting for passwords.
HADDOCK was setup to use each of the 32 compute-node CPUs by creating a simple csh
wrapper script called <i>"haddock_wrapper"</i> that contains two lines like this:
<BR>
<pre>
cd <i>project_directory</i>
csh -f $1
</pre>
Then, in the run.cns file, we define our "queues" like:
<pre>
{===>} queue_1="rsh node1 ~/bin/haddock_wrapper";
{===>} cns_exe_1="cns";
{===>} cpunumber_1=2;

{===>} queue_2="rsh node1 ~/bin/haddock_wrapper";
{===>} cns_exe_2="cns";
{===>} cpunumber_2=2;

...
</pre>
etc - one "queue" for each compute node to be included in this haddock run.
<br>
<br>
If rsh is blocked, you can use instead ssh, but for this to work you need to set up ssh such
as no password is needed. See for that:<br>
<a href="http://www.astro.caltech.edu/~mbonati/WIRC/manual/DATARED/setting_up_no-password_ssh.html">http://www.astro.caltech.edu/~mbonati/WIRC/manual/DATARED/setting_up_no-password_ssh.html</a>
<br>
(Thanks to Andrea Spitaleri)
<BR>
<hr>
<BR>
<a name="batchqueue"><b><u> Running HADDOCK on a cluster using a queuing system (e.g. PBS or Torque)</u></b></a>
<BR><BR>
In order to submit to the queuing system we use typically a wrapper script that will add some directives to the job files. Here is one example of such a wrapper script called <i>ssub</i> that would submit to the default queue:<BR>
<pre>
#!/bin/csh -f
if ($#argv < 1) then
  echo "Usage : ssub jobname"
  exit 1
endif

# check if job exists + make it executable
set jobname=$1
if (! -e $1) then
  echo "job file does not exist"
  exit 1
endif
if (! -x $jobname) chmod +x $jobname

# write temporary pbs script
set pbsjob=$jobname.pbsjob.$$
if (! -e $pbsjob) then
  touch $pbsjob
else
  \rm $pbsjob
  touch $pbsjob
endif
set PWD=`pwd`

echo "#PBS -S" $SHELL >> $pbsjob
set outfile=$PWD/$jobname.out.$$ >> $pbsjob
echo "#PBS -o $outfile" >> $pbsjob
set errorfile=$PWD/$jobname.err.$$ >> $pbsjob
echo "#PBS -e $errorfile" >> $pbsjob
echo "#PBS -m n" >> $pbsjob
echo "cd $PWD" >> $pbsjob
echo "./$jobname" >>$pbsjob

chmod +x $pbsjob
qsub -j eo $pbsjob
rm -rf $pbsjob
exit
</pre>
<BR>
<lo> Change your run.cns script (here we assume <i>ssub</i> is in your path, otherwise give the full path to it):
<BR>
<pre>
{===>} queue_1="ssub";
{===>} cns_exe_1="/home/software/software/cns_solve_1.31-UU/intel-x86_64bit-linux/bin/cns";
{===>} cpunumber_1=100;
</pre>
<BR>
This will cause HADDOCK to submit 100 jobs simultaneously to the batch system. Once a structure comes back the next job will be submitted.
You can adapt the wrapper script to submit to specific queues.
<br><br>
Note that since the rigid-body docking jobs (it0) are usually very fast, it is possible to bundle a number of those into a single job to avoid overloading the batch system.
For this edit in your HADDOCK installation the following file: <i>Haddock/Main/QueueSubmit_concat.py</i> and change the value of <i>jobmax["it0"]</i>. 
In the following example, 5 docking jobs would be concatenated into one job for it0:
<BR>
<pre>
jobmax["it0"] = 5
jobmax["it1"] = 1
jobmax["water"]= 1
</pre>
<BR>
<hr>
<BR>
<a name="ligand"><b><u> Small ligand docking with HADDOCK</u></b></a>
<BR><BR>
It's possible to dock small ligands using HADDOCK but for that topology and parameter files for the ligand should be provided in CNS format. Several sources exist to find such files:
<ul>
   <li> the <b>PRODGR</b> server maintained by Daan van Aalten at Dundee University: 
    <a href="http://davapc1.bioch.dundee.ac.uk/programs/prodrg/prodrg.html">http://davapc1.bioch.dundee.ac.uk/programs/prodrg/prodrg.html</a><br>
    This server allows you to draw your molecule or paste coordinates and will return topologies
    and parameter files in various format, including CNS. You should turn on the electrostatic to
    obtain partial charges. Save the resulting PDB file and the corresponding CNS parameter 
    and topology files to use in HADDOCK.<BR><BR>
    <b>Important:</b> The generated parameter file contains a CNS NBONds statement which should be
    removed prior to use in HADDOCK. Look in the parameter file for:
<BR>
<pre>
     NBONds
       CUTNB=7.0 WMIN=1.5
       REPEL=1.0 REXPONENT=4
       IREXPONENT=1 RCONST=16.0
       TOLERANCE=0.5 NBXMOD=5
       CTONNB=5.5 CTOFNB=6.0
     END
</pre>
and remove or comment it out (by adding ! before each line).
<BR><BR>
   <li> the Automated Topology Builder (ATB) and Repository developed in Prof. Alan Mark's group at the University of Queensland in Brisbane:
   <a href="http://compbio.biosci.uq.edu.au/atb">http://compbio.biosci.uq.edu.au/atb</a><br>
   <b>Notei</b>: we did not yet test those parameters in HADDOCK.
<BR><BR>
   <li> the <b>HIC-Up</b> database maintained by Gerard Kleywegt at Uppsalla University: 
    <a href="http://xray.bmc.uu.se/hicup/">http://xray.bmc.uu.se/hicup</a><br>
    One problem with those files for use in docking is that typically all partial charges are 
    set to zero, <u>meaning that the electrostatic interaction energies will thus be zero unless you
    change the partial charges</u>. Still, the HIC-Up topology and parameter files provide a good
    starting point.<BR><BR>
</ul>
For docking small ligand with HADDOCK using custom-made topology and parameter files and 
perform the following steps:
<ol>
   <li>Setup your HADDOCK run in the usual way, i.e. generating the <i>new.html</i> file 
       and running haddock first to generate the run directory structure.</li>
   <BR>
   <li>Place your custom topology and parameter files in the <i>toppar</i> directory.</li>
   <BR>
   <li>When modifying the docking parameters in <i>run.cns</i>, specify the proper topology
       and parameter files for your ligand. Or alternatively, place the topology and parameter files of your
       ligand in the <i>toppar/ligand.top</i> and <i>toppar/ligand.param</i> files, respectively.</li>
   <BR>
   <li>To avoid that a N- or C-terminal patch be applied to your ligand, add "first IONS" and "last IONS"
       statements with the name of your ligand in the <ib>topallhdg5.3.pep</i> file in the <i><b>toppar</b></i> 
       directory (look for the "first IONS" and "last IONS" statements).</li>
</ol>
Also we recommend to set the number of MD steps for the first two parts (rigid-body high temperature dynamic and
slow cooling annealing) of the <a href="/software/haddock2.2/docking#sa"> semi-flexible refinement</a> to 0.
<BR><BR>
<b>Important1:</b> When starting a run, always check for error messages in the begin directory in the
various generate...out files, especially for your ligand.  
<hr>
