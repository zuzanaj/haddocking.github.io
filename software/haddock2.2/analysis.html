---
layout: page
tags: [Jekyll, HADDOCK, Bonvin, Docking, Simulation, Molecular Dynamics, Structural Biology, Computational Biology, Modelling, Protein Structure]
modified: 2014-08-08T20:53:07.573882-04:00
comments: false
image:
  feature: pages/banner_software.jpg
---

<H1><FONT COLOR=RED>HADDOCK2.2</FONT> manual</H1>

<H2 align=right><FONT COLOR=RED>A</FONT>nalysis</H2> 

<HR>
The analysis of the docking results are performed after the 
<a href="/software/haddock2.2/docking#sa">semi-flexible simulated annealing step</a> and after the 
<a href="/software/haddock2.2/docking#water">explicit solvent refinement</a>. A number of 
<a href="#auto">standard CNS analysis</a> scripts are automatically run by HADDOCK and the 
results are placed in the <b>analysis</b> directory in <b>runX/structures/it1</b> and 
<b>runX/structures/it1/water</b>, respectively. Some of the generated output files are parsed
automatically by HADDOCK to generate for example violations statistics (see 
<a href="#viol">violation analysis</a>).  Another important step consists in a 
<a href="#manual">manual analysis</a> of the generated structures and their clusters. 
This is the critical step for the classification of the docking solutions and the 
identification of the best(s) cluster(s).
<BR><BR>
<u>Topics:</u>
<ul>
  <li> <a href="#auto">Standard analysis performed by HADDOCK</a>
  <ul>
     <li> <a href="#average">Average structure and RMSDs</a>
     <li> <a href="#rmsd">pairwise RMSD matrix</a>
     <li> <a href="#ener">Energy and buried surface area analysis</a>
     <li> <a href="#desol">Desolvation energy analysis</a>
     <li> <a href="#resener">Per-residue interaction energy</a>
     <li> <a href="#geom">Covalent geometry analysis</a>
     <li> <a href="#noes">Distance restraints (AIRs, unambig, Hbonds) violations analysis</a>
     <li> <a href="#dihe">Dihedral angle restraints violations analysis</a>
     <li> <a href="#sani">Residual dipolar coupling restraints violations analysis</a>
     <li> <a href="#vean">Intervector projection angle restraints violations analysis</a>
     <li> <a href="#dani">Diffusion anisotropy restraints violations analysis</a>
     <li> <a href="#hb">Intermolecular hydrogen bonds analysis</a>
     <li> <a href="#nb">Intermolecular hydrophobic contacts analysis</a>
     <BR><BR>
  </ul>
  <li> <a href="#viol">Violation analysis</a>
  <BR><BR>
  <li> <a href="#manual">Manual analysis</a>
  <ul>
     <li> <a href="#anastruc">Structure statistics</a>
     <li> <a href="#clusterrmsd">RMSD-based clustering of solutions</a>
     <li> <a href="#clusterfcc">FCC-based clustering of solutions</a>
     <li> <a href="#anaclust">Cluster analysis</a>
  </ul>
  <li> <a href="#reanal">Rerunning the analysis for a given cluster</a>
</ul>
<BR>
<hr>
<hr>
<a name="auto"><h3><u> Standard analysis performed by HADDOCK</u></h3></a>
<BR>
The following CNS analysis scripts are automatically run by HADDOCK:
<ul>
     <li> <a href="#average">Average structure and RMSDs</a>
     <li> <a href="#rmsd">Pairwise RMSD matrix</a>
     <li> <a href="#ener">Energy and buried surface area analysis</a>
     <li> <a href="#desol">Desolvation energy analysis</a>
     <li> <a href="#resener">Per-residue interaction energy</a>
     <li> <a href="#geom">Covalent geometry analysis</a>
     <li> <a href="#noes">Distance restraints (AIRs, unambig, Hbonds) violations analysis</a>
     <li> <a href="#dihe">Dihedral angle restraints violations analysis</a>
     <li> <a href="#sani">Residual dipolar coupling restraints violations analysis</a>
     <li> <a href="#vean">Intervector projection angle restraints violations analysis</a>
     <li> <a href="#dani">Diffusion anisotropy restraints violations analysis</a>
     <li> <a href="#hb">Intermolecular hydrogen bonds analysis</a>
     <li> <a href="#nb">Intermolecular hydrophobic contacts analysis</a>
</ul>
<hr>
<BR>
<li><a name="average"><b><u>get_average.inp</u></b></a>: This script will calculate an average structure by 
superimposing the structures on the backbone atoms of the flexible interface 
defined in the <a href="/software/haddock2.2/run#flex">run.cns</a> parameter file. 
<BR><BR>
<ul><b><i>Note1:</i></b> If less than three atoms are selected when using the defined semi-flexible 
            segments, then the entire backbone will used. If still less than three atoms are selected, 
            then all heavy atoms will be used for the fitting. This makes sure that at least three atoms 
            are selected for any molecule, including small ligands. 
</ul>
The structures are fitted onto the average structures and written to disk in the <b>analysis</b>
directory. Various average rmsds calculated over the ensemble of structure and rmsds from 
the average for each structure are output to file.
<BR><BR>
Output files:
<ul>
  <li> <i>fileroot_ave.pdb</i>: average structure
  <BR><BR>
  <li> <i>filerootfit_1.pdb, filerootfit_2.pdb, ...</i>: superimposed structures
  <BR><BR>
  <b><i>Note2:</i></b> The numbering of the superimposed PDB files does not correspond
                      with the numbering in the <b>it1</b> or <b>water</b> directories,
                      but to the position of the structure in the sorted <i>file.list</i>
                      file, i.e. structure number 1 in the <b>analysis</b> directory 
                      is the first (best) in <i>file.list</i> and structure number 50 is at 
                      position 50 in that file.
  <BR><BR>
  <li> <i>rmsave.disp</i>:  contains the RMSD from the average structure for each structure and
       the average values over the ensemble. For this, the structures are superimposed on the backbone
       atoms of the flexible interface (see <b><i>Note1</i></b> above) and the following average RMSD 
       values from the average structure are calculated and written to file:
  <ul>
    <li> RMSD backbone interface of all molecules
    <li> RMSD complete backbone of all molecules
    <li> backbone interface of molecule A
    <li> backbone interface of molecule B
    <li> backbone interface of molecule C
    <li> ...
  </ul>
  <BR><BR> In addition to the average RMSD calculated from the entire ensemble, the corresponding single structure 
      RMSD values are listed in <i>rmsave.disp</i>
  <BR><BR>
  <li> <i>rmsdseq.disp</i>: per residue RMSDs (backbone heavy atoms (N,CA,C), extended backbone heavy atoms
       (N,CA,CB,C,O), side-chain heavy atoms and all heavy atoms.
  <BR><BR>
  <li> <i>fileroot-reduced.crd</i>: trajectory file containing only the coordinates of the flexible interface
        backbone atoms (see <b><i>Note1</i></b> above); this reduced file is used to calculate the 
        <a href="#rmsd">pairwise RMSD matrix</a> and thereby speed up the calculations.
</ul>
<hr>
<BR>
<li><a name="rmsd"><b><u>rmsd.inp</u></b></a>: This script calculates the pairwise RMSD matrix over all 
structures. For this the structures are first superimposed on the flexible interface backbone atoms of molecule A 
and the RMSD is calculated on the flexible interface backbone atoms of the other molecules 
(see <b><i>Note1</i></b> above). This RMSD can be termed: "ligand interface RMSD". 
<BR>
<BR>
Output files:
<BR>
<ul>
   <li> <i>fileroot_rmsd.disp</i>: this file contains the pairwise RMSD matrix with on each line three number:
        the structure numbers of the two structures being compared and the corresponding RMSD value.
   <BR><BR>
   <b><i>Note5:</i></b> The numbering of the structures corresponds to the position of the structure 
                       in the sorted <i>file.list</i> file.
   <BR><BR>
   This file is used as input for the RMSD <a href="#clusterrmsd">clustering</a>.
</ul>
<hr>
<BR>
<li><a name="ener"><b><u>energy.inp</u></b></a>: this script performs the analysis of bonded and non-bonded energies
per structure and averaged over the ensemble. Various energy terms are calculated:
<ul>
   <li> over the entire complex
   <li> over the flexible interface only (as defined in the <a href="/software/haddock2.2/run#flex">run.cns</a> parameter file)
   <li> only the intermolecular energies (vdw and elec)
</ul>
In addition, the buried surface area is also reported. The buried surface area is calculated by taking the difference
between the sum of the solvent accessible surface area for each molecule separately and the solvent accessible area of
the complex. The solvent accessible area is calculated using a 1.4A water probe radius and an accuracy of 0.075A (in
case of memory problems for very large complexes increase this value, e.g. 0.1 or higher).
<BR><BR>
Output files:
<ul>
  <li> <i>energies.disp</i>: this file contains the various energy terms per structure and averaged over the ensemble
  <BR><BR>
  <ul>
     <li> Complex statistics: <i>Etot, Ebond, Eangle, Eimpr, Edihed, Evdw, Eelec</i>
     <li> Flexible interface statistics:  <i>Etot, Evdw, Eelec</i>
     <li> Intermolecular statistics: <i>Etot, Evdw, Eelec</i>
     <li> Buried surface area
  </ul>
</ul>	 
<hr>
<li><a name="desol"><b><u>edesolv.inp</u></b></a>: this script performs the analysis desolvation energy
per structure and averaged over the ensemble. The desolvation energy is calculated using the empirical 
atomic solvation parameters from Fernandez-Recio <i>et al.</i> <i>JMB</i> <b>335</b>:843 (2004). These are
defined in the <i>def_solv_param.cns</i> CNS script in the <i><b>protocols</b></i> directory.
<BR><BR>
Output files:
<ul>
  <li> <i>edesolv.disp</i>: this file contains the  desolvation energy per structure and averaged over the ensemble
</ul>	 
<hr>
<li><a name="resener"><b><u>ene-residue.inp</u></b></a>: this script performs a per-residue intermolecular
interaction energy analysis for all residues which make intermolecular contacts. 
A residue is selected for analysis if it makes at least one contact within 5A within the ensemble analysed.
Van der Waals, electrostatic and total interaction energies are reported per structure and as averages over the
ensemble. They are calculated using the default 8.5A cutoff and a dielectric constant of 1 (all defined in the
<i>read_struc.cns</i> CNS script.
<BR><BR>
Output files:
<ul>
  <li> <i>ene-residue.disp</i>: this file contains the various energy terms per structure and averaged over
   the ensemble<BR><BR>
Example:
</ul>	
<PRE>
    #Residue ASP 38 A - intermolecular energies
    #file Etot Evdw Eelec
    # PREVIT:e2a-hpr_161.pdb -16.7601 -3.41526 -13.3448
    # PREVIT:e2a-hpr_189.pdb -42.4061 -1.83788 -40.5682
    ...
    # mean values for interaction with residue ASP 38 A
    # ASP 38 A : Etot   -34.528 (+/- 21.4012 ) [kcal/Mol]
    # ASP 38 A : Evdw   -1.34906 (+/- 0.967306 ) [kcal/Mol]
    # ASP 38 A : Eelec  -33.179 (+/- 21.1375 ) [kcal/Mol]
    ...
</PRE>
The average per-residue values can be easily extracted from this file and sorted in decreasing contribution with the following command:
<pre>
grep ": Evdw" ene-residue.disp |sort -gk7
grep ": Eele" ene-residue.disp |sort -gk7
grep ": Etot" ene-residue.disp |sort -gk7
</pre>
<hr>
<BR>
<li><a name="geom"><b><u>print_geom.inp</u></b></a>: this script performs the analysis of the covalent geometry, 
reporting on the deviations from ideal values for bonds, angles, impropers and dihedrals. The deviations per 
structure and averaged over the ensemble are reported.
<BR><BR>
Output files:
<ul>
  <li> <i>geom.disp</i>: this file contains the averaged deviations from ideal geometry per structure and 
       averaged over the ensemble.
  <BR><BR>
  <li> <i>print_geom.out</i>: this file contains the listing of covalent terms deviating from the ideal geometry:
  <ul>
    <li> bonds > 0.025 A
    <li> angles > 2.5 degrees
    <li> improper dihedrals > 2.5 degrees
    <li> dihedral angles > 30 degrees
  </ul>
</ul>	 
<hr>
<BR>
<li><a name="noes"><b><u>print_noes.inp</u></b></a>: this script performs the analysis of distance (including AIR)
 restraint violations, generating output for all restraints combined and for each type of restraints (unambiguous, 
 ambiguous (or AIRs) and hbonds) separately.
<BR><BR>
Output files:
<ul>
  <li> <i>noe.disp</i>: this file contains the number of distance restraints violations per 
       structure and averaged over the ensemble over all distance restraint classes and for each 
       class (unambiguous, ambiguous, hbonds) separately.  Distance restraints violation > 0.5, 0.3 
       and 0.1 A are reported.
  <BR><BR>
  <li> <i>print_dist_all.out</i>: this file contains the violation listing for all distance restraints including hbond restraints. 
  <BR><BR>
  <li> <i>print_dist_noe.out</i>: this file contains the violation listing for all distance distance restraints 
       (unambiguous and ambiguous classes). 
  <BR><BR>
  <li> <i>print_noe_unambig.out</i>: this file contains the violation listing for the unambiguous 
       distance restraints.
  <BR><BR>
  <li> <i>print_noe_ambig.out</i>: this file contains the violation listing for the ambiguous distance 
       restraints (typically the class used to define Ambiguous Interaction Restraints). 
  <BR><BR>
  <li> <i>print_dist_hbonds.out</i>: this file contains the violation listing for the hydrogen bond distance restraints.
  <BR><BR>
  <ul><b><i>Note6:</i></b>: The above five files (print_....out) are parsed automatically by HADDOCK to 
         generate statistics on a restraint basis over all structures in the ensemble 
         using the <b>ana_noe_viol.csh</b> script provided in the <b>tools</b> directory (see 
      <a href="#viol">violation analysis</a>).
  </ul>
</ul>	 
<hr>
<BR>
<li><a name="dihe"><b><u>print_dih.inp</u></b></a>: this script performs the analysis of dihedral angle restraint
violations, listing per structure the violations above 5 degree and the average violations over the entire ensemble.
<BR><BR>
Output files:
<ul>
  <li> <i>dihedrals.disp</i>: this file contains the number of dihedral restraints violations per structure 
       and averaged over the ensemble.
  <BR><BR>
  <li> <i>print_dih.out</i>: this file contains the violation listing for all dihedral restraints. This file 
       is parsed automatically by HADDOCK to generate statistics on a restraint basis over all structures in the 
       ensemble using the <b>ana_dihed_viol.csh</b> script provided in the <b>tools</b> directory (see 
       <a href="#viol">violation analysis</a>).
</ul>	 
<hr>
<BR>
<li><a name="sani"><b><u>print_sani.inp</u></b></a>: this script performs the analysis of
<a href="/software/haddock2.2/RDC_help">dipolar coupling restraint</a>
violations, listing per structure the average rms violations and the number of violations above 1.0, 0.5 and 0.2 Hz, 
respectively. It also reports the average rms violation over the entire ensemble.
<BR><BR>
Output files:
<ul>
  <li> <i>sani.disp</i>: this file contains the number of dipolar coupling violations per structure and 
       averaged over the ensemble.
  <BR><BR>
  <li> <i>print_sani.out</i>: this file contains the dipolar couplings violation listing. (No automatic 
       parsing of this file is currently implemented).
</ul>	 
<hr>
<BR>
<li><a name="vean"><b><u>print_vean.inp</u></b></a>: this script performs the analysis of 
<a href="/software/haddock2.2/RDC_help#vean">intervector projection angle restraint</a> violations, listing per 
structure the violations above 5 degrees. It also reports the average rms violation over the entire ensemble.
<BR><BR>
Output files:
<ul>
  <li> <i>vean.disp</i>: this file contains the number of intervector projection angle restraints violations 
       per structure and averaged over the ensemble.
  <BR><BR>
  <li> <i>print_vean.out</i>: this file contains the intervector projection angle restraints violation listing. 
       (No automatic parsing of this file is currently implemented).
</ul>	 
<hr>
<BR>
<li><a name="dani"><b><u>print_dani.inp</u></b></a>: this script performs the analysis of 
<a href="/software/haddock2.2/DANI_help">diffusion anisotropy restraint</a>
violations, listing per structure the average rms violations and the number of violations above 1.0, 0.5 and 0.2, 
respectively. It also reports the average rms violation over the entire ensemble.
<BR><BR>
Output files:
<ul>
  <li> <i>dani.disp</i>: this file contains the number of diffision anisotropy violations per structure and averaged over the
       ensemble.
  <BR><BR>
  <li> <i>print_dani.out</i>: this file contains the diffision anisotropy violation listing. (No automatic parsing of this
       file is currently implemented).
</ul>	 
<hr>
<BR>
<li><a name="hb"><b><u>print_hbonds.inp</u></b></a>: this script performs the analysis of intermolecular hydrogen bonds.
The definition of an hydrogen  bond is however a crude one since it is only based on the proton-acceptor distance. This
distance can be specified in the <a href="/software/haddock2.2/run#hbnb">run.cns</a> parameter file (default is 2.5A).
<BR><BR>
Output files:
<ul>
  <li> <i>hbonds.disp</i>: this file contains a listing of all intermolecular hydrogen bonds over the ensemble of
       structures. It is automatically parsed by HADDOCK using the <i>ana_hbonds.csh</i> script located
       in the <b>tools</b> directory. This scripts generate a listing (<i>ana_hbonds.lis</i>) of 
       intermolecular hydrogen bonds including the number of occurrences and the average hydrogen bond 
       distance.
  <BR><BR>
  <ul>
  <b><i>Note7:</i></b> The <i>ana_hbonds.csh</i> script can also be run manually. For this simply copy the
                     <i>ana_hbonds.csh</i> and <i>count_hbonds.awk</i> scripts from the <b>tool</b> directory into
                      the analysis directory and type:
  </ul>
</ul>	 
<pre>
          ./ana_hbonds.csh hbonds.disp
</pre>
<hr>
<BR>
<li><a name="nb"><b><u>print_nb.inp</u></b></a>: this script performs the analysis of intermolecular hydrophobic contacts.
An hydrophobic contact is identified when two carbon atoms are at less than a user-defined distance, typically 3.9A. This
distance cut-off can be specified in the <a href="/software/haddock2.2/run#anal">run.cns</a> parameter file (default is 3.9A).
<BR><BR>
Output files:
<ul>
  <li> <i>nbcontacts.disp</i>: this file contains a listing of all intermolecular hydrophobic contacts 
       over the ensemble of structures. It is automatically parsed by HADDOCK using the <i>ana_hbonds.csh</i> 
       script located in the <b>tools</b> directory. This scripts generate a listing (<i>ana_nbconbtacts.lis</i>) 
       of intermolecular hydrophobic contacts including the number of occurrences and the average C-C distance.
  <BR><BR>
  <ul>
  <b><i>Note8:</i></b> The <i>ana_hbonds.csh</i> script can also be run manually. For this simply copy the
                      <i>ana_hbonds.csh</i> and <i>count_hbonds.awk</i> scripts from the <b>tool</b> directory into
 										 the analysis directory and type:
  </ul>
</ul>	 
<pre>
          ./ana_hbonds.csh nbcontacts.disp
</pre>
<hr>
<hr>
<BR>
<a name="viol"><h3><u>Violations analysis</u></h3></a>
HADDOCK performs automatically a number of violations analysis, generating a listing of violations including the number of
times a restraint is violated and the average distance and violation per restraint. This is done for distance restraints
(all distances (distances + Hbonds), distances only, unambiguous distances only, ambiguous distances only, dihedral angle restraints).
A number of <i>.lis</i> files are generated in the <i><b>analysis</b></i> directory:
<BR>
<ul>
  <li><i>ana_dihed_viol.lis</i>: dihedral angles violations if a dihedral file has been input in the new.html<br>
  <li><i>ana_dist_viol.lis</i>: all distance (including Hbonds) restraints violations
  <li><i>ana_hbond_viol.lis</i>: hydrogen bond restraints violations
  <li><i>ana_noe_viol_all.lis</i>: all distance restraints violations
  <li><i>ana_noe_viol_unambig.lis</i>: unambiguous distance restraint violations
  <li><i>ana_noe_viol_ambig.lis</i>: ambiguous distance restraints (this is the restraint type typically used for the
	    ambiguous interaction restraints (AIRs).
</ul>
Distance restraint violations > 0.3 A and dihedral angle restraints violations > 5 degree are reported.
All atoms belonging to one restraints are listed, which in the case of ambiguous interaction restraints can 
be a very large number exceeding 1000! A new line always starts with <i>Rexp=</i>.
<BR><BR>
Example:
<PRE> <FONT SIZE=-1>
    Rexp=   2.000 Rave=   4.739 Viol=  -2.739 #viol=  200 (    B    36   HIS     N ...
    Rexp=   2.000 Rave=   4.626 Viol=  -2.626 #viol=  200 (    B    65   ASP     N ...
    Rexp=   2.000 Rave=   4.345 Viol=  -2.345 #viol=  200 (    B    33   GLN     N ...
    Rexp=   2.000 Rave=   4.037 Viol=  -2.037 #viol=    1 (    B    92   GLY     N ...
    Rexp=   2.000 Rave=   3.225 Viol=  -1.225 #viol=   63 (    A    37   SER     N ...
    ...
</PRE> </FONT SIZE=-1>
<i>Rexp=   2.000</i> corresponds to the upper distance restraint (in Angstrom) defined in the AIR restraint file).
<BR><BR> 
<i>Rave=   4.739</i> corresponds to the average distance (in Angstrom) in the calculated structures.
<BR><BR>
<i>Viol=  -2.739</i> corresponds to the violation in Angstrom.
<BR><BR> 
<i>#viol=  200</i> corresponds to the number of structures in which the restraint is violated.
<BR>
<hr>
<hr>
<BR>
<a name="manual"><h3><u>Manual analysis</u></h3></a>
An important part of the analysis, namely the analysis of the clusters, needs to be performed
manually. A number of scripts are provided for this purpose in the <b>runX/tools</b> directory.
<BR>
<hr>
<li><a name="anastruc"><b><u>ana_structures.csh</u></b>:</a>  This script should run once the 
   <i>file.list</i> file has been created. It extracts from the header of the PDB files various energy terms, 
   violation statistics and buried surface area and calculates the RMSD of each structure compared to the 
   lowest energy one (if the location of  ProFit is defined (see <a href="/software/haddock2.2/installation">installation</a> 
   and <a href="/software/haddock2.2/software">software links</a>)).
   <BR><BR>
   To run it type:
   <pre>
   $HADDOCKTOOLS/ana_structures.csh
   </pre>
   in the directory where <i>file.list</i> has been created (e.g. <i><b>structures/it1</b></i> or 
   <i><b>structures/it1/water</b></i>).
   <BR><BR>
   Ten files are created:
   <ul>
     <li><i><b>structures_haddock-sorted.stat</b></i> <ul>sorting based on <a href="/software/haddock2.2/run#scoring">haddock score</a> 
     (as in <i> file.list</i>)</ul>
     <li><i>structures_air-sorted.stat</i> <ul>sorting based on distance restraint energy</ul>
     <li><i>structures_airviol-sorted.stat</i> <ul>sorting based on number of distance violations</ul>
     <li><i>structures_bsa-sorted.stat</i> <ul>sorting based on buried surface area</ul>
     <li><i>structures_dH-sorted.stat</i> <ul>sorting based on total energy difference calculated as total energy of the complex - Sum of total energies of the individual components</ul>
     <li><i>structures_Edesolv-sorted.stat</i> <ul>sorting based on desolvation energy calculated using the
     empirical atomic solvation parameters from Fernandez-Recio <i>et al.</i> <i>JMB</i> <b>335</b>:843 (2004)
     </ul>
     <li><i>structures_ene-sorted.stat</i> <ul>sorting based on total energy (only intermolecular components for vdw and elec energies)</ul>
     <li><i>structures_nb-sorted.stat</i> <ul>sorting based on non-bonded intermolecular energy</ul>
     <li><i>structures_nbw-sorted.stat</i> <ul>sorting based on weighted non-bonded intermolecular energy ( 1*vdw + 0.1*elec)</ul>
     <li><i>structures_rmsd-sorted.stat</i> <ul>sorting based on RMSD from best (lowest) HADDOCK score structure</ul>
     <BR>
   </ul>
   These files looks like:
</ul>
<PRE> <FONT SIZE=-1>
#struc haddock-score RMSD-Emin Einter Enb Evdw+0.1Eelec Evdw Eelec Eair Ecdih Ecoup Esani Evean Edani #NOEviol #Dihedviol #Jviol #Saniviol #veanviol #Daniviol bsa dH Edesolv
e2a-hpr_71w.pdb -164.13017 0.000 -629.446 -635.908 -107.853 -49.1804 -586.728 6.4629 0 0 0 0 0 0 0 0 0 0 0 1613.82 -8593.04 1.74954
e2a-hpr_171w.pdb -156.04058 0.748 -613.411 -624.683 -103.675 -45.7858 -578.897 11.2722 0 0 0 0 0 0 0 0 0 0 0 1663.99 -8501.99 4.3974
e2a-hpr_38w.pdb -150.756688 0.624 -574.337 -587.378 -97.1234 -42.6507 -544.727 13.0407 0 0 0 0 0 0 0 0 0 0 0 1688.07 -8600.72 -0.464658
...
</PRE> </FONT SIZE=-1>
<BR>
The first line of those files gives the description of the columns, e.g.
the first column corresponds to the pdb file, the second column to the combined HADDOCK score, the third 
to the backbone RMSD from the lowest energy structure, the third column to the total intermolecular energy 
(sum of all energy terms), the fourth column to the intermolecular non-bonded energy (vdw+elec),...
<BR><BR>
You can generated a plot of the HADDOCK score as a function of the RMSD (using XMGR for example).
<BR><BR>
A simple script called <i>make_ene-rmsd_graph.csh</i> is provided in $HADDOCKTOOLS which allows you
to generate an input file for <a href="http://plasma-gate.weizmann.ac.il/Grace/">Xmgr/XmGrace</a>. 
Simply specify two columns to extract data from and a filename:
<pre>
  $HADDOCKTOOLS/make_ene-rmsd_graph.csh 3 2 structures_unsorted.stat
</pre>
This will generate a file called <i>ene_rmsd.xmgr</i> which you can display with xmgr or xmgrace:
<pre>
  xmgrace ene_rmsd.xmgr
</pre>
<hr>
<BR>
<li><a name="clusterrmsd"><b><u>RMSD-based clustering of solutions using cluster_struc</u></b>:</a> 
The clustering is run automatically by HADDOCK in <i><b>it1/analysis</b></i> and <i><b>it1/water/analysis</b></i> 
based on the criteria defined in the <a href="/software/haddock2.2/run#clust">run.cns</a> file. 
In case RMSD-based clustering has been selected, a reasonable cutoff value to start with for protein-protein complexes is 7.5A.
We recommend however that you try using different cut-offs for the clustering since it is difficult to know
a priori the best cut-off. This will depend on the system under study and the number of experimental restraints
used to drive the docking. If only a small fraction of the structures cluster, try increasing the cut-off.
<BR><BR>
<b>cluster_struc</b> is a simple C++ program provided in the <i><b>tools</b></i> directory that read the 
<a href=#rmsd><i>fileroot_rmsd.disp</i></a> file containing the pairwise rmsd matrix and generates clusters. This
program should have been compiled for your system during <a href="/software/haddock2.2/installation">installation</a>. 
<BR><BR>
Two clustering algorithms are implemented:
<ol>
<li>using an algorithm as described in Daura et al. <i>Angew. Chem. Int. Ed.</i> <b>38</b>:236-240 (1999): 
count number of neighbors using cut-off, take structure with largest number of neighbors with 
all its neighbors as cluster and eliminate it from the pool of clusters. Repeat for remaining 
structures in pool.<BR><BR>
<li>full linkage: add a structure to a cluster when its distance to any element of
the cluster is less than the cutoff.
</ol>
The full linkage option generates thus larger clusters and the structures within a cluster can thus differ more. It is 
called by using the <i>-f</i> option. The default option used by HADDOCK is the first one (algorithm of Daura et al.). 
To use full linkage rerun the clustering manually.
<BR><BR>
The usage is:
<PRE> <FONT SIZE=-1>
   cluster_struc [-f]  fileroot_rmsd.disp cut-off  min_cluster_size >cluster.out
</PRE> </FONT SIZE=-1>
Example for its use:
<PRE> <FONT SIZE=-1>
  cluster_struc e2a-hpr_rmsd.disp 7.5 4 >cluster.out
</PRE> </FONT SIZE=-1>
will create clusters using a 7.5 A RMSD cut-off requiring a minimum of four structures per cluster.
<BR><BR>
The output looks like:
<PRE>
    Cluster 1 -> <FONT COLOR=RED>8</FONT COLOR=RED> 1 2 3 5 6 7 9 10 11 12 13 14 15 ...
    Cluster 2 -> 23 25 26 29 39 62 66 67 72 74 78 ...
    Cluster 3 -> 153 4 32 43 96 131 147 158 163 ..
</PRE>
The numbers correspond to the structure number in the analysis file. For example
<b><font color="red">8</font></b> corresponds to structure number 8 in
analysis, i.e, the eigth structure in <i>file.list</i> in <i><b>it1/water</b></i>.
The first structure of each cluster above corresponds to the cluster center. The remaining structures are sorted according to 
their index.
<BR><BR>

<BR>
<hr>
<BR>
<li><a name="clusterfcc"><b><u>Contact-based clustering of solutions using cluster_fcc.py</u></b>:</a> 
The clustering is run automatically by HADDOCK in <i><b>it1/analysis</b></i> and <i><b>it1/water/analysis</b></i> 
based on the criteria defined in the <a href="/software/haddock2.2/run#clust">run.cns</a> file. 
In case FCC clustering has been chosen (which means clustering based on the fraction of common contacts), a reasonable cutoff value to start with for protein-protein complexes is 0.75.
We recommend however that you try using different cut-offs for the clustering since it is difficult to know
a priori the best cut-off. This will depend on the system under study and the number of experimental restraints
used to drive the docking. If only a small fraction of the structures cluster, try decreasing the cut-off.
<BR><BR>
<b>cluster_fcc.py</b> is a python code provided in the <i><b>tools</b></i> directory that read the 
<i>fileroot_fcc.disp</i> file containing the pairwise fraction of common contact matrix and generates clusters. 
The clustering algorithm is described in Rodrigues et al. <a href="https://doi.org/doi:10.1002/prot.24078"><i>Proteins: Struc. Funct. & Bioinformatic</i>, <b>80</b> 1810-1817 (2012)</a>.
<BR><BR>
The usage is:
<PRE> <FONT SIZE=-1>
Usage: cluster_fcc.py <matrix file> <threshold [float]> [options]

Options:
  -h, --help            show this help message and exit
  -o OUTPUT_HANDLE, --output=OUTPUT_HANDLE
                        Output File [STDOUT]
  -c CLUS_SIZE, --cluster-size=CLUS_SIZE
                        Minimum number of elements in a cluster [4]
</PRE> </FONT SIZE=-1>
Example for its use:
<PRE> <FONT SIZE=-1>
  python cluster_fcc.py e2a-hpr_fcc.disp 0.75 -c 4 >cluster.out
</PRE> </FONT SIZE=-1>
will create clusters using a 0.75 FCC cut-off requiring a minimum of four structures per cluster.
<BR><BR>
The output looks the same as for the RMSD-based clustering explained above
<BR><BR>

<BR>
<hr>
<BR>
<li><a name="anaclust"><b><u>ana_clusters.csh</u></b>:</a> This script takes the output of 
<b>cluster_struc</b> to perform an analysis of the various clusters, calculating average energies, 
RMSDs and buried surface area per cluster.
<BR><BR>
To run it, type with as argument the output file of the clustering, e.g.:
<pre>
   $HADDOCKTOOLS/ana_clusters.csh [-best #] analysis/cluster.out
</pre>
<BR>
The <b>[-best #]</b> is an optional (but recommended!) argument to generate additional files with cluster 
averages calculated only on the best <b>#</b> structures of a cluster. The best structures are selected based on the
HADDOCK score defined in <a href="/software/haddock2.2/run#iter">run.cns</a>, i.e. the sorting found in <i>file.list</i>. 
This allows to remove the dependency of the cluster averages upon the size of the respective clusters. The
following example will calculate cluster averages over the best 45 structures.
<pre>
   $HADDOCKTOOLS/ana_clusters.csh -best 4 analysis/cluster.out
</pre>
<BR>
The <b>ana_clusters.csh</b> script analyzes the clusters in a similar way as the <b>ana_structures.csh</b> script,
but in addition generates average values over the structures belonging to one cluster. It creates a number of files for each
cluster containing the cluster number <i>clustX</i> in the name:
<ul>
  <li><i>file.cns_clustX</i>
      <ul>contains the name of all the pdb files that belong to the cluster X (CNS format)</ul>
  <li><i>file.nam_clustX</i>
      <ul>contains the name of all the pdb files that belong to the cluster X</ul>
  <li><i>file.list_clustX</i>
      <ul>contains the name of all the pdb files that belong to the cluster X  (list format)</ul>
  <BR><BR>
  And in addition if the option <i>-best Y</i> is used:
  <BR><BR>
  <li><i>file.cns_clustX_bestY</i>
      <ul>contains the name of the best Y pdb files that belong to the cluster X (CNS format)</ul>
  <li><i>file.nam_clustX_bestY</i>
      <ul>contains the name of the best Y  pdb files that belong to the cluster X</ul>
  <li><i>file.list_clustX_bestY</i>
      <ul>contains the name of the best Y pdb files that belong to the cluster X  (list format)</ul>
  <BR>
  <b><i>Note9:</i></b> Those files can be used to repeat the HADDOCK analysis for a single cluster (see below).
  <BR><BR><BR>
  <li><i>file.nam_clustX_bsa</i> 
      <ul>contains the buried surface area of each structure of cluster X</ul>
  <li><i>file.nam_clustX_dH</i> 
      <ul>contains the total energy difference calculated as total energy of the complex - Sum 
          of total energies of the individual components</ul>
  <li><i>file.nam_clustX_Edesol</i> 
      <ul>contains the desolvation energy calculated using the empirical atomic solvation parameters
          from Fernandez-Recio <i>et al.</i> <i>JMB</i> <b>335</b>:843 (2004)</ul>
  <li><i>file.nam_clustX_ener</i> 
      <ul>contains all the energy terms (intermolecular, Van der Waals, electrostatic and AIR) for 
          each structures of cluster X </ul>
  <li><i>file.nam_clustX_haddock-score</i> 
      <ul>contains the combined <a href="/software/haddock2.2/run#scoring">haddock score</a> </ul>
  <li><i>file.nam_clustX_rmsd</i> 
      <ul>contains the RMSD of each structure of cluster X from the best (lowest) HADDOCK score 
          structure of cluster X.  </ul>
  <li><i>file.nam_clustX_rmsd-Emin</i> 
      <ul>contains the RMSD of each structure of cluster X from the best (lowest) HADDOCK score 
          structure of all calculated structures  </ul>
  <li><i>file.nam_clustX_viol</i> 
      <ul>contains the number of AIR and dihedral violations per structure </ul>
  <BR>
  <b><i>Note10:</i></b> The ordering of the structures in those files follows the HADDOCK score ranking.
  <BR><BR>
</ul>
Eight files containing various averages over clusters are created:
<ul>
  <li><i>cluster_bsa.txt</i> 
      <ul>contains the average buried surface area of each cluster and the standard deviation</ul>
  <li><i>cluster_dH.txt</i> 
      <ul>contains the average total energy difference calculated as total energy of the complex
       - Sum of total energies of the individual components</ul>
  <li><i>cluster_Edesolv.txt</i> 
      <ul>contains the average desolvation energy calculated using the empirical atomic solvation parameters
          from Fernandez-Recio <i>et al.</i> <i>JMB</i> <b>335</b>:843 (2004)</ul>
  <li><i>cluster_ener.txt</i> 
      <ul>contains the average energy terms of each cluster and the standard deviations</ul>
  <li><i>cluster_haddock.txt</i> 
      <ul>contains the average combined <a href="/software/haddock2.2/run#scoring">haddock score</a></ul>
  <li><i>cluster_rmsd.txt</i> 
      <ul>contains the average RMSD and standard deviation from the best (lowest) HADDOCK score structure 
          of cluster of the structures belonging to that cluster </ul>
  <li><i>cluster_rmsd-Emin.txt</i> 
      <ul>contains the average RMSD and standard deviation of the clusters from the 
          best (lowest) HADDOCK score structure of all calculated structures</ul>
  <li><i>cluster_viol.txt</i> 
      <ul>contains the average AIR and dihedral violations for each cluster and the 
          standard deviations</ul>
</ul>and twelve files combining all the above information and sorted based on various criteria:<ul>
  <li><b><i>clusters_haddock-sorted.stat</i></b> 
      <ul>contains the various cluster averages sorted as a function of the 
          combined <a href="/software/haddock2.2/run#scoring">haddock score</a></ul>
  <li><i>clusters.stat</i> 
      <ul>contains the various cluster averages sorted as a function of the cluster number</ul>
  <li><i>clusters_air-sorted.stat</i> 
      <ul>contains the various cluster averages sorted accordingly to the AIR energy</ul>
  <li><i>clusters_bsa-sorted.stat</i> 
      <ul>contains the various cluster averages accordingly to the buried surface area</ul>
  <li><i>clusters_dani-sorted.stat</i> 
      <ul>contains the various cluster averages accordingly to the diffusion anisotropy restraint energy</ul>
  <li><i>clusters_dH-sorted.stat</i> 
      <ul>contains the various cluster averages accordingly to the total energy difference calculated 
          as total energy of the complex - Sum of total energies of the individual components</ul>
  <li><i>clusters_Edesolv-sorted.stat</i> 
      <ul>contains the various cluster averages accordingly to the desolvation energy calculated using 
          the empirical atomic solvation parameters from Fernandez-Recio <i>et al.</i> <i>JMB</i> <b>335</b>:843 (2004)</ul>
  <li><i>clusters_ene-sorted.stat</i> 
      <ul>contains the various cluster averages accordingly to the intermolecular energy (restraints+vdw+elec)</ul>
  <li><i>clusters_nb-sorted.stat</i> 
      <ul>contains the various cluster averagesd accordingly to the intermolecular non-bonded energy (vdw+elec)</ul>
  <li><i>clusters_nbw-sorted.stat</i> 
      <ul>contains the various cluster averages accordingly to the weighted intermolecular non-bonded energy (vdw+0.1*elec)</ul>
  <li><i>clusters_sani-sorted.stat</i> 
      <ul>contains the various cluster averages accordingly to the RDC (direct, SANI) restraint energy</ul>
  <li><i>clusters_vean-sorted.stat</i> 
      <ul>contains the various cluster averages accordingly to the RDC (intervector projection angles, VEAN) 
          restraint energy</ul>
</ul>
If the option <b>-best</b> is given with a number of structures, additional files with as extension <b>_best#</b>
will be created containing the average values over the best # structures.
<BR><BR>
You can plot the HADDOCK score of the clusters as a function of their RMSD from the lowest energy
structure (using <a href="http://plasma-gate.weizmann.ac.il/Grace/">xmgr/xmgrace</a> for example).
<BR><BR>
<img align=center src="/software/haddock2.2/haddock-score_vs_rmsd.png" width="500" alt="graph">
<BR><BR>
The gray circles correspond to the individual structures and the filled circles correspond to the cluster
averages with the standard deviation indicated by bars.
<BR><BR>
The assumption is then that the best (lowest) HADDOCK score structures of the best (lowest) HADDOCK score 
cluster are the best solution generated by HADDOCK. It is then up to you to confirm that using any kind of 
information you can get such as for example:
<ul>
  <li> mutagenesis data
  <li> conservation of given residues from multiple alignments
  <li> ...
</ul>
<hr>
<hr>
<BR>
<a name="reanal"><h3><u>Rerunning the analysis for a given cluster</u></h3></a>
It is possible to rerun the HADDOCK analysis for a given cluster. For this, the <i>file.cns</i>, 
<i>file.list</i> and <i>file.nam</i> files should be renamed by adding for example a suffix <i>_all</i>.
These three files contain the sorted list of all structures calculated. Similarly, the <b>analysis</b>
directory should be renamed. Create then an empty analysis directory and cope the files containing the PDB
file listings for a given cluster (these are created when performing the analysis of the clusters with
<a href="#anaclust">ana_clusters.csh</a>) to <i>file.cns</i>, <i>file.list</i> and <i>file.nam</i>, respectively.
<BR><BR>
To simplify this entire procedure, we are providing a csh script named <b>make_links.csh</b> in the <b>tools</b>
directory (defined by the environment variable $HADDOCKTOOLS). To make the links type:
<pre>
    $HADDOCKTOOLS/make_links.csh clust1
</pre>
This will automatically move the original files (<i>file.cns</i>, <i>file.list</i> and <i>file.nam</i>) and rename
the <b>analysis</b> directory. A new analysis directory called <b>analysis_clust1</b> will be created and 
a link to it will be created as <b>analysis</b>. Similarly, links will be created for the three listing files:
<BR>
<pre>
   file.cns  -> file.cns_clust1
   file.list -> file.list_clust1
   file.nam  -> file.nam_clust1
</pre>
To rerun the analysis go back to the <b>runX</b> directory and restart HADDOCK.
<BR><BR>
<b><i>Warning:</i></b> In case you wish to experiment with different <a href="#cluster">clustering cut-offs</a>
   restore first the original files containing the information for all calculated structures with the command:
   <pre>
   $HADDOCKTOOLS/make_links.csh all
   </pre>
<hr>
